<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–∫–≤–µ—Å—Ç: —Å–∫—Ä–∞—Ñ—Ç—å —Å–≤–æ–π —Ç–æ—Ä—Ç!</title>
  <style>
    body {
      margin: 0;
      background: #1e1e2e;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }

    h1 {
      margin: 15px;
      text-align: center;
    }

    .crafting-area {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px;
    }

    .grid {
      width: 400px;
      height: 400px;
      background: url("grid-bg.png") no-repeat center center;
      background-size: contain;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 2px;
    }

    .slot {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slot img {
      max-width: 80%;
      max-height: 80%;
      pointer-events: none;
    }

    .inventory {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .item {
      width: 64px;
      height: 64px;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 5px;
      text-align: center;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h1>–ö–≤–µ—Å—Ç: —Å–∫—Ä–∞—Ñ—Ç—å —Ç–æ—Ä—Ç</h1>

  <div class="crafting-area">
    <div class="grid" id="grid">
      <div class="slot" data-pos="0"></div>
      <div class="slot" data-pos="1"></div>
      <div class="slot" data-pos="2"></div>
      <div class="slot" data-pos="3"></div>
      <div class="slot" data-pos="4"></div>
      <div class="slot" data-pos="5"></div>
      <div class="slot" data-pos="6"></div>
      <div class="slot" data-pos="7"></div>
      <div class="slot" data-pos="8"></div>
    </div>
  </div>

  <div class="inventory">
  <img src="milk.png" alt="milk" data-item="milk" class="item" draggable="true">
  <img src="sugar.png" alt="sugar" data-item="sugar" class="item" draggable="true">
  <img src="egg.png" alt="egg" data-item="egg" class="item" draggable="true">
  <img src="wheat.png" alt="wheat" data-item="wheat" class="item" draggable="true">
</div>

  <div class="result" id="result">
    –ü–µ—Ä–µ—Ç–∞—â–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ —Å–µ—Ç–∫—É –ø–æ —Ä–µ—Ü–µ–ø—Ç—É!
  </div>

<script>
/* –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç: pointer drag (mobile) + HTML5 drag (desktop) + tap-to-place */
const slots = Array.from(document.querySelectorAll('.slot'));
const items = Array.from(document.querySelectorAll('.item'));
const result = document.getElementById('result');

let attempts = 0;               // —Å—á—ë—Ç—á–∏–∫ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ª–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
let selectedType = null;        // –¥–ª—è tap-to-place
let selectedSrc = null;
let currentDrag = { type: null, src: null, ghost: null };

/* --- helper: –ø–æ–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ —Å–ª–æ—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ --- */
function placeImageInSlot(slot, type, src) {
  if (!slot) return;
  slot.innerHTML = '';
  const img = document.createElement('img');
  img.src = src;
  img.alt = type || '';
  img.draggable = false;
  slot.appendChild(img);
  updateAndCheck();
}

/* --- —Å–æ–±—Ä–∞—Ç—å —Ç–µ–∫—É—â—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –∏ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É --- */
function updateAndCheck(){
  const layout = slots.map(s => s.querySelector('img') ? s.querySelector('img').alt : null);
  checkRecipe(layout);
}

/* --- –î–ª—è –∫–∞–∂–¥–æ–≥–æ item: pointerdrag + dragstart (desktop) + tap-to-place --- */
items.forEach(item => {
  // pointerdown –¥–ª—è —Ç–∞—á–∞/–º—ã—à–∏ (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ)
  item.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    currentDrag.type = item.dataset.item || item.alt || null;
    currentDrag.src = item.src;

    // —Å–æ–∑–¥–∞—ë–º ghost
    const ghost = document.createElement('div');
    ghost.style.position = 'fixed';
    ghost.style.left = '0px';
    ghost.style.top = '0px';
    ghost.style.width = '84px';
    ghost.style.height = '84px';
    ghost.style.transform = 'translate(-50%,-50%)';
    ghost.style.zIndex = 9999;
    ghost.style.pointerEvents = 'none';
    const gi = document.createElement('img');
    gi.src = currentDrag.src;
    gi.style.width = '100%';
    gi.style.height = '100%';
    gi.style.objectFit = 'contain';
    ghost.appendChild(gi);
    document.body.appendChild(ghost);
    currentDrag.ghost = ghost;

    function moveGhost(clientX, clientY){
      if(currentDrag.ghost){
        currentDrag.ghost.style.left = clientX + 'px';
        currentDrag.ghost.style.top = clientY + 'px';
      }
    }

    const clearGhost = () => {
      if(currentDrag.ghost && currentDrag.ghost.parentNode){
        currentDrag.ghost.remove();
      }
      currentDrag = { type: null, src: null, ghost: null };
    };

    const onMove = (ev) => moveGhost(ev.clientX, ev.clientY);
    const onUp = (ev) => {
      document.removeEventListener('pointermove', onMove);
      document.removeEventListener('pointerup', onUp);
      const el = document.elementFromPoint(ev.clientX, ev.clientY);
      const slot = el ? el.closest('.slot') : null;
      if (slot) {
        placeImageInSlot(slot, currentDrag.type, currentDrag.src);
      }
      clearGhost();
    };

    document.addEventListener('pointermove', onMove, { passive: true });
    document.addEventListener('pointerup', onUp);

    // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞: –µ—Å–ª–∏ —Ç–∞–ø–Ω—É–ª–∏ –≤–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä —Å–∫—Ä–æ–ª–ª/–æ—Ç–º–µ–Ω–∞) ‚Üí —É–±—Ä–∞—Ç—å ghost
    document.addEventListener('pointercancel', clearGhost, { once: true });
  }, { passive: false });

  // desktop fallback: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π dragstart (–¥–ª—è –º—ã—à–∏)
  item.addEventListener('dragstart', (e) => {
    const type = item.dataset.item || item.alt || '';
    e.dataTransfer.setData('text/plain', type);
    e.dataTransfer.setData('img', item.src);
  });

  // tap-to-place (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ —Ç–∞–ø–Ω—É–ª ‚Äî –≤—ã–±–∏—Ä–∞–µ–º)
  item.addEventListener('click', (e) => {
    selectedType = item.dataset.item || item.alt || null;
    selectedSrc = item.src;
    // –º–æ–∂–Ω–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å
    items.forEach(i => i.classList.toggle('selected', i === item));
  });
});

/* --- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drop –¥–ª—è —Å–ª–æ—Ç–æ–≤ (desktop drag & drop) --- */
slots.forEach((slot) => {
  slot.addEventListener('dragover', e => e.preventDefault());
  slot.addEventListener('drop', (e) => {
    e.preventDefault();
    const type = e.dataTransfer.getData('text/plain') || null;
    const src = e.dataTransfer.getData('img') || null;
    if (src) placeImageInSlot(slot, type, src);
  });

  // click on slot: –µ—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π item (tap-to-place) ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å,
  // –∏–Ω–∞—á–µ –µ—Å–ª–∏ —Å–ª–æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å
  slot.addEventListener('click', (e) => {
    if (selectedType && selectedSrc) {
      placeImageInSlot(slot, selectedType, selectedSrc);
      selectedType = null;
      selectedSrc = null;
      items.forEach(i => i.classList.remove('selected'));
      return;
    }
    // –µ—Å–ª–∏ –Ω–µ—Ç –≤—ã–±–æ—Ä–∞ ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å —Å–ª–æ—Ç –ø—Ä–∏ –∫–ª–∏–∫–µ
    const img = slot.querySelector('img');
    if (img) {
      slot.innerHTML = '';
      updateAndCheck();
    }
  });
});

/* --- –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Ü–µ–ø—Ç–∞ –∏ –ø–æ–ø—ã—Ç–æ–∫ --- */
function checkRecipe(layout) {
  const correct = [
    "milk","milk","milk",
    "sugar","egg","sugar",
    "wheat","wheat","wheat"
  ];

  const allFilled = layout.every(v => v !== null);

  // –µ—Å–ª–∏ –≤—Å—ë —Å–æ–≤–ø–∞–ª–æ
  if (JSON.stringify(layout) === JSON.stringify(correct)) {
    result.innerHTML = `
      ‚úÖ –£—Ä–∞! –¢—ã —Å–∫—Ä–∞—Ñ—Ç–∏–ª–∞ —Ç–æ—Ä—Ç! –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—é –±—ã—Ç—å! <br>
      <img src="cake.png" alt="cake" style="width:64px;height:64px;margin:10px;"><br>
      üéâ –ê —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –≤ –¥–∏—Ä–µ–∫—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∞ 2, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
    `;
    attempts = 0;
    return;
  }

  // –µ—Å–ª–∏ –Ω–µ –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –Ω–µ —Å—á–∏—Ç–∞–µ–º –ø–æ–ø—ã—Ç–∫—É
  if (!allFilled) return;

  // –≤—Å–µ 9 –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ ‚Äî —É—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–ø—ã—Ç–∫—É
  attempts++;
  if (attempts < 4) {
    result.innerHTML = "‚ùå –ù–µ –≤–µ—Ä–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, –∏–Ω–∞—á–µ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –±—É–¥–µ—Ç –±–µ–∑ —Ç–æ—Ä—Ç–∞!";
  } else {
    result.innerHTML = `
      ‚ùå –ù–µ –≤–µ—Ä–Ω–æ!<br>
      üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:<br>
      –º–æ–ª–æ–∫–æ-–º–æ–ª–æ–∫–æ-–º–æ–ª–æ–∫–æ<br>
      —Å–∞—Ö–∞—Ä-—è–π—Ü–æ-—Å–∞—Ö–∞—Ä<br>
      –ø—à–µ–Ω–∏—Ü–∞-–ø—à–µ–Ω–∏—Ü–∞-–ø—à–µ–Ω–∏—Ü–∞
    `;
    // attempts = 0; // –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–±—Ä–æ—Å –ø–æ—Å–ª–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π
  }

  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å–µ—Ç–∫–∏ –ø–æ—Å–ª–µ –Ω–µ–≤–µ—Ä–Ω–æ–π –ø–æ–ª–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
  // if (allFilled) slots.forEach(s => s.innerHTML = '');
}
</script>
</body>
</html>
